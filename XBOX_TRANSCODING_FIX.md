# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å Xbox —Ç—Ä–∞–Ω—Å–∫–æ–¥–∏–Ω–≥–æ–º

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ —Ñ–∏–ª—å–º–æ–≤ –Ω–∞ Xbox –≤ —Ä–µ–∂–∏–º–µ —Ç—Ä–∞–Ω—Å–∫–æ–¥–∏–Ω–≥–∞ —á–µ—Ä–µ–∑ ~26-30 –º–∏–Ω—É—Ç –ø–æ—è–≤–ª—è–ª–æ—Å—å —Å–æ–æ–±—â–µ–Ω–∏–µ "–≤—Å–µ —Å–µ—Ä–∏–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω—ã" –∏ —Ñ–∏–ª—å–º –æ—Ç–º–µ—á–∞–ª—Å—è –∫–∞–∫ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–π, —Ö–æ—Ç—è –µ–≥–æ —Ä–µ–∞–ª—å–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –±—ã–ª–∞ 1.5 —á–∞—Å–∞ –∏–ª–∏ –±–æ–ª—å—à–µ.

## –†–µ—à–µ–Ω–∏–µ

–ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã **–¥–≤–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã**:

### 1. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –≤–∏–¥–µ–æ
- **–ü—Ä–∏—á–∏–Ω–∞**: `ffprobe` –ø–æ–ª—É—á–∞–ª –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
- **–†–µ—à–µ–Ω–∏–µ**: –£–≤–µ–ª–∏—á–µ–Ω—ã –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∞–Ω–∞–ª–∏–∑–∞ —Å 5 —Å–µ–∫—É–Ω–¥ –¥–æ 100 —Å–µ–∫—É–Ω–¥

### 2. –ü—Ä–µ–∂–¥–µ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Ç–æ—Ä—Ä–µ–Ω—Ç–∞ —Å TorrServer
- **–ü—Ä–∏—á–∏–Ω–∞**: –ü—Ä–∏ —Ç—Ä–∞–Ω—Å–∫–æ–¥–∏–Ω–≥–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª–∞—Å—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑, —á–µ—Ä–µ–∑ 3 –º–∏–Ω—É—Ç—ã —Ç–æ—Ä—Ä–µ–Ω—Ç —É–¥–∞–ª—è–ª—Å—è
- **–†–µ—à–µ–Ω–∏–µ**: 
  - –£–≤–µ–ª–∏—á–µ–Ω —Ç–∞–π–º–∞—É—Ç —Å 3 –¥–æ 30 –º–∏–Ω—É—Ç
  - –î–æ–±–∞–≤–ª–µ–Ω keep-alive –º–µ—Ö–∞–Ω–∏–∑–º (–ø–∏–Ω–≥ –∫–∞–∂–¥—ã–µ 2 –º–∏–Ω—É—Ç—ã)

## –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

### –¢–∞–π–º–∞—É—Ç—ã
- ‚è±Ô∏è **–¢–∞–π–º–∞—É—Ç –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏**: 3 –º–∏–Ω—É—Ç—ã ‚Üí **30 –º–∏–Ω—É—Ç**
- üîÑ **–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—á–∏—Å—Ç–∫–∏**: –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥ ‚Üí **–∫–∞–∂–¥—ã–µ 60 —Å–µ–∫—É–Ω–¥**
- üíì **Keep-alive –ø–∏–Ω–≥**: **–∫–∞–∂–¥—ã–µ 2 –º–∏–Ω—É—Ç—ã** (–Ω–æ–≤–æ–µ!)

### –ü–æ–≤–µ–¥–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

**–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```
0:00 - –ó–∞–ø—É—Å–∫ —Ç—Ä–∞–Ω—Å–∫–æ–¥–∏–Ω–≥–∞
0:00 - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
3:00 - –¢–æ—Ä—Ä–µ–Ω—Ç —É–¥–∞–ª—ë–Ω (timeout!)
3:01 - FFmpeg —Ç–µ—Ä—è–µ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫ ‚Üí –≤—ã–ª–µ—Ç
```

**–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```
0:00 - –ó–∞–ø—É—Å–∫ —Ç—Ä–∞–Ω—Å–∫–æ–¥–∏–Ω–≥–∞ + keep-alive
2:00 - Keep-alive –ø–∏–Ω–≥ (–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∞)
4:00 - Keep-alive –ø–∏–Ω–≥ (–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∞)
...
1:30:00 - –ö–æ–Ω–µ—Ü —Ñ–∏–ª—å–º–∞, keep-alive –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
2:00:00 - –¢–æ—Ä—Ä–µ–Ω—Ç —É–¥–∞–ª—ë–Ω —á–µ—Ä–µ–∑ 30 –º–∏–Ω—É—Ç –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
```

## –õ–æ–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

### –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Ç—Ä–∞–Ω—Å–∫–æ–¥–∏–Ω–≥–∞:
```bash
üìç Registered activity for torrent: transcoding (HASH)
‚è∞ Started keep-alive for torrent: transcoding (HASH), ping every 2 minutes
üéµ Starting FFmpeg audio-only transcoding (video copy) for: ...
```

### –í–æ –≤—Ä–µ–º—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ (–∫–∞–∂–¥—ã–µ 2 –º–∏–Ω—É—Ç—ã):
```bash
üíì Keep-alive ping for torrent: transcoding (HASH)
üìç Registered activity for torrent: transcoding (HASH)
```

### –ü—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏:
```bash
FFmpeg transcoding finished successfully
‚è∞ Stopped keep-alive for torrent: transcoding (HASH)
```

### –ü—Ä–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–µ (—á–µ—Ä–µ–∑ 30 –º–∏–Ω—É—Ç –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è):
```bash
üóëÔ∏è Torrent transcoding (HASH) has been inactive for 30 minutes (timeout: 30 min)
üóëÔ∏è Auto-removing inactive torrent: transcoding (HASH)
‚úÖ Cleaned up 1 inactive torrents
```

## –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä** –∏ –æ—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –ª–æ–≥–æ–≤
2. **–ù–∞—á–Ω–∏—Ç–µ –ø—Ä–æ—Å–º–æ—Ç—Ä** –Ω–∞ Xbox –≤ —Ä–µ–∂–∏–º–µ —Ç—Ä–∞–Ω—Å–∫–æ–¥–∏–Ω–≥–∞
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏** - –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–ª—è—Ç—å—Å—è —Å–æ–æ–±—â–µ–Ω–∏—è:
   - `‚è∞ Started keep-alive` –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
   - `üíì Keep-alive ping` –∫–∞–∂–¥—ã–µ 2 –º–∏–Ω—É—Ç—ã
4. **–°–º–æ—Ç—Ä–∏—Ç–µ —Ñ–∏–ª—å–º** –±–æ–ª–µ–µ 30 –º–∏–Ω—É—Ç - –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–π –æ–± —É–¥–∞–ª–µ–Ω–∏–∏ —Ç–æ—Ä—Ä–µ–Ω—Ç–∞
5. **–ü–æ—Å–ª–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞** - keep-alive –¥–æ–ª–∂–µ–Ω –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ç–æ—Ä—Ä–µ–Ω—Ç–æ–≤

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ —Ç–æ—Ä—Ä–µ–Ω—Ç—ã –º–æ–∂–Ω–æ —á–µ—Ä–µ–∑ API:

```bash
curl http://localhost:3000/api/active-torrents
```

–û—Ç–≤–µ—Ç:
```json
{
  "count": 1,
  "inactivityTimeout": "1800s",
  "torrents": [
    {
      "hash": "ABC123...",
      "title": "transcoding",
      "lastActivity": "2025-10-29T10:30:00.000Z",
      "inactiveFor": "120s"
    }
  ]
}
```

## –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞** –Ω–∞ –Ω–∞–ª–∏—á–∏–µ keep-alive –ø–∏–Ω–≥–æ–≤
2. **–£–±–µ–¥–∏—Ç–µ—Å—å**, —á—Ç–æ keep-alive –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è (—Å–æ–æ–±—â–µ–Ω–∏–µ `‚è∞ Started keep-alive`)
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ**, –Ω–µ —É–¥–∞–ª—è–µ—Ç—Å—è –ª–∏ —Ç–æ—Ä—Ä–µ–Ω—Ç –ø—Ä–µ–∂–¥–µ–≤—Ä–µ–º–µ–Ω–Ω–æ (—Å–æ–æ–±—â–µ–Ω–∏–µ `üóëÔ∏è Auto-removing`)
4. **–û—Ç–∫—Ä–æ–π—Ç–µ issue** —Å –ø–æ–ª–Ω—ã–º–∏ –ª–æ–≥–∞–º–∏ —Å–µ—Ä–≤–µ—Ä–∞

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:
- `src/torrServerClient.js` - –¥–æ–±–∞–≤–ª–µ–Ω keep-alive –º–µ—Ö–∞–Ω–∏–∑–º
- `server.js` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è keep-alive –≤ —Ç—Ä–∞–Ω—Å–∫–æ–¥–∏–Ω–≥ endpoint
- `public/app.js` - –∑–∞—â–∏—Ç–∞ –æ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –æ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ torrServerClient:
- `startKeepAlive(hash, title)` - –∑–∞–ø—É—Å–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- `stopKeepAlive(hash)` - –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- –£–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

## –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞

–ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–¥–∞:

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä (Ctrl+C)
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∑–∞–Ω–æ–≤–æ
npm start
```

---

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û (29 –æ–∫—Ç—è–±—Ä—è 2025)
**–í–µ—Ä—Å–∏—è**: 2.0
**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞**: Xbox —á–µ—Ä–µ–∑ —Ç—Ä–∞–Ω—Å–∫–æ–¥–∏–Ω–≥


